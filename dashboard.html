<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>لوحة المدير — نظام المدرسة</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="assest/css/style.css">
</head>
<body>
  <!-- Topbar -->
  <nav class="navbar topbar py-2">
    <div class="container-fluid d-flex justify-content-between">
      <h5 class="mb-0 text-white">لوحة المدير</h5>
      <div class="text-end text-white small-muted">نظام إدارة المدرسة</div>
    </div>
  </nav>

  <div class="container mt-4">
    <!-- الإحصائيات -->
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3">
        <div class="card-panel stat-card stat-student p-3 text-center">
          <h6>الطلاب</h6>
          <h3 id="statStudents">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card-panel stat-card stat-teacher p-3 text-center">
          <h6>المدرسين</h6>
          <h3 id="statTeachers">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card-panel stat-card stat-supervisor p-3 text-center">
          <h6>الموجهين</h6>
          <h3 id="statSupervisors">0</h3>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="card-panel stat-card stat-notes p-3 text-center">
          <h6>الملاحظات</h6>
          <h3 id="statNotes">0</h3>
        </div>
      </div>
    </div>

    <!-- الرسوم البيانية -->
    <div class="row g-3 mb-4">
      <div class="col-12 col-md-6">
        <div class="card-panel p-3">
          <h6>توزيع الطلاب حسب الصفوف</h6>
          <canvas id="studentsChart" height="200"></canvas>
        </div>
      </div>
      <div class="col-12 col-md-6">
        <div class="card-panel p-3">
          <h6>توزيع الملاحظات</h6>
          <canvas id="notesChart" height="200"></canvas>
        </div>
      </div>
    </div>

    <!-- إضافة مستخدم -->
    <div class="row g-3">
      <section class="col-12 col-md-6">
        <div class="card-panel p-3">
          <h6>إضافة مستخدم جديد</h6>
          <form id="addUserForm" class="row g-2 mt-2">
            <div class="col-12">
              <input type="text" id="userName" class="form-control" placeholder="اسم المستخدم" required>
            </div>
            <div class="col-12">
              <select id="userRole" class="form-select" required>
                <option value="">اختر الدور</option>
                <option value="student">طالب</option>
                <option value="teacher">مدرس</option>
                <option value="supervisor">موجه</option>
              </select>
            </div>
            <div class="col-12">
              <button type="submit" class="btn btn-primary w-100">إضافة مستخدم</button>
            </div>
          </form>
        </div>
      </section>

      <!-- إضافة ملاحظة -->
      <section class="col-12 col-md-6">
        <div class="card-panel p-3">
          <h6>إضافة ملاحظة</h6>
          <form id="addNoteForm" class="row g-2 mt-2">
            <div class="col-12">
              <textarea id="noteText" class="form-control" rows="3" placeholder="اكتب الملاحظة..." required></textarea>
            </div>
            <div class="col-6">
              <select id="noteTargetRole" class="form-select" required>
                <option value="">إرسال إلى</option>
                <option value="student">طالب</option>
                <option value="teacher">مدرس</option>
              </select>
            </div>
            <div class="col-6 text-start">
              <button type="submit" class="btn btn-primary w-100">إرسال الملاحظة</button>
            </div>
          </form>
          <hr>
          <h6>الملاحظات الأخيرة</h6>
          <div id="notesList">
            <!-- الملاحظات تظهر هنا -->
          </div>
        </div>
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // بيانات تجريبية
    const users = { students:[], teachers:[], supervisors:[] };
    const notes = [];

    function updateStats(){
      document.getElementById('statStudents').textContent = users.students.length;
      document.getElementById('statTeachers').textContent = users.teachers.length;
      document.getElementById('statSupervisors').textContent = users.supervisors.length;
      document.getElementById('statNotes').textContent = notes.length;
      renderCharts();
    }

    function renderNotes(){
      const list = document.getElementById('notesList');
      if(!notes.length){
        list.innerHTML = `<div class="small-muted text-center p-2">لا توجد ملاحظات حالياً</div>`;
        return;
      }
      list.innerHTML = notes.map(n => `
        <div class="card-panel p-2 mb-2">
          <strong>${n.role === 'student' ? 'طالب' : 'مدرس'}</strong> - ${n.text} <br/>
          <small class="text-muted">${n.date}</small>
        </div>
      `).join('');
    }

    // إضافة مستخدم
    document.getElementById('addUserForm').addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('userName').value.trim();
      const role = document.getElementById('userRole').value;
      if(!name || !role) return;
      users[role+'s'].push({ name, id: role+'-'+Date.now() });
      document.getElementById('userName').value = '';
      document.getElementById('userRole').value = '';
      updateStats();
      alert('تم إضافة المستخدم بنجاح!');
    });

    // إضافة ملاحظة
    document.getElementById('addNoteForm').addEventListener('submit', function(e){
      e.preventDefault();
      const text = document.getElementById('noteText').value.trim();
      const role = document.getElementById('noteTargetRole').value;
      if(!text || !role) return;
      notes.unshift({ text, role, date: new Date().toLocaleString() });
      document.getElementById('noteText').value = '';
      document.getElementById('noteTargetRole').value = '';
      renderNotes();
      updateStats();
    });

    // الرسوم البيانية
    let studentsChart, notesChart;
    function renderCharts(){
      const studentCounts = [users.students.length, users.teachers.length, users.supervisors.length];
      const noteCounts = [notes.filter(n=>n.role==='student').length, notes.filter(n=>n.role==='teacher').length];

      if(studentsChart) studentsChart.destroy();
      if(notesChart) notesChart.destroy();

      const ctx1 = document.getElementById('studentsChart').getContext('2d');
      studentsChart = new Chart(ctx1, {
        type:'doughnut',
        data:{
          labels:['طلاب','مدرسين','موجهين'],
          datasets:[{data:studentCounts, backgroundColor:['#4cc9f0','#f72585','#7209b7']}]
        }
      });

      const ctx2 = document.getElementById('notesChart').getContext('2d');
      notesChart = new Chart(ctx2, {
        type:'bar',
        data:{
          labels:['طلاب','مدرسين'],
          datasets:[{
            label:'عدد الملاحظات',
            data:noteCounts,
            backgroundColor:['#4cc9f0','#f72585']
          }]
        },
        options:{indexAxis:'y', scales:{x:{beginAtZero:true}}}
      });
    }

    // Init
    updateStats();
    renderNotes();
  </script>
</body>
</html>
